---
import { twMerge } from "tailwind-merge";
import Painting from "./Painting.astro";
import type { PaintingWithDetailsProps } from "@interfaces/IComponentProps";
import {
  artImagesData,
  creatorFullname,
  detailRowArrayValueWithFallback,
} from "src/utils/misc";
import DetailRowArray from "./DetailRowArray.astro";

export type Props = PaintingWithDetailsProps;

const { item, itemClassName = "", ...props } = Astro.props;

const creators = detailRowArrayValueWithFallback({
  data: item.creators.map((creator) => {
    const artistName = creatorFullname(creator.description);
    return {
      value: artistName,
      href: `/artist/${creator.id}?name=${artistName}`,
    };
  }),
});

const getTitle = (): string => {
  const ratio =
    (Number(artImagesData?.(item.images)?.height ?? 1) /
      Number(artImagesData?.(item.images)?.width ?? 1)) *
    1.1;

  const ratioedLength = Math.floor(item.title.length * ratio);

  if (item.title.length <= ratioedLength) return item.title;
  return `${item.title.slice(0, ratioedLength)}...`;
};
const title = getTitle();
---

<a
  href={`/artwork/${item.id.toString()}`}
  class={twMerge("flex flex-col cursor-pointer", itemClassName)}
>
  <div class="flex flex-col relative">
    <Painting images={item.images} assignSizes />
    <div
      class="flex flex-col absolute bottom-0 z-10 bg-gradient-to-t from-zinc-800 w-full pb-3 pt-8 px-3 text-white"
    >
      <DetailRowArray
        title={title}
        titleClassName="text-lg"
        valueClassName="text-white/90"
        values={creators}
        {...props}
      />
    </div>
  </div>
</a>
